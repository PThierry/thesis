%%
%%
%% definitions_of_inputs.tex for thesis in /doctorat/these/tex
%%
%% Made by Philippe THIERRY
%% Login   <Philippe THIERRYreseau-libre.net>
%%
%% Started on  Fri Mar 12 16:23:03 2010 Philippe THIERRY
%% Last update Mon Apr  4 14:48:19 2011 Philippe THIERRY
%%

\chapter{Measurement and usage of WCET}


%\begin{changemargin}{1cm}{1cm}
{\it
A real-time system is a system which guarantee that all its tasks meet their relative deadlines.\\
There is two different real-time systems:
\begin{itemize}
\item hard real-time systems, in which all executed tasks relative deadlines must be met in order
to avoid a huge impact on the overall system execution.
\item soft real-time systems, in which some deadlines can be overtaken without having any serious
impacts on the system execution. Such overtaking usually impacts the associated quality of services
\end{itemize}
In both cases, a value is used in order to define the needed capacities : the worst case execution
time of a task.
}
%\end{changemargin}
\doMinitoc

\section{Preliminary definitions}

\subsection{Defining real-time}

\paragraph{}
As shown in Figure \ref{fig:rt_hard_soft}, there is three main tasks families:
\begin{itemize}
\item Hard Real-Time tasks. These tasks must meet their deadline in order to generate usable
results. In the otherwise, the tasks results are not valuable.
\item Soft Real-Time tasks. If these tasks don't meet their deadline, their results' usage decline
with the time over-consumption.
\item Best-effort tasks. These tasks don't have any deadline to meet. Their results are always
usable, whatever the task execution time is.
\end{itemize}

\begin{figure}[h]
\input{figures/real_time_lines.tex}
\caption{The three main task families}
\label{fig:rt_hard_soft}
\end{figure}

\subsection{About real-time attributes}
\label{sec:primarydef}

\paragraph{}
A Real-Time tasks $\tau_{i}$ has three main attributes depending on the task and one attribute
depending on the scheduling scheme:
\begin{itemize}
\item It's Worst Case Execution Time (usually named as \gls{wcet}), denoted $C_{i}$
\item It's Deadline, defining the maximum duration allowed in order to execute the one task
instantiation, denoted $_{i}$.
\item It's Period, defining the minimum time slice between two instantiations. This period may be
considered like a fixed value or a minimum valued. It is denoted $P_{i}$. A task instantiation is
named a {\it job}.
\item For each job, the associated response time, corresponding to the worst case time needed in
order to complete the job execution, is denoted $R_{i}$.
\end{itemize}

\paragraph{}
A set of Real-Time tasks is denoted a {\it task set}. A task set also has properties, derived from
its real-time tasks.

\subsection{Defining the WCET}

\paragraph{}
Le \gls{wcet} ({\it Worst Case Execution Time}) defines the worst case execution time of a task.
Associated to the task's deadline, it allows:
\begin{itemize}
\item to know by advance if a task set is schedulable on a given system, or if some tasks may not
be completed soon enough to meet their deadlines.
\item to define a temporal (and sometime spacial) repartition of tasks in order to meet every
deadlines.
\end{itemize}

\paragraph{}
In order to guarantee the schedulability of each task $\tau_{i}$, the attributes defined in Section
\ref{sec:primarydef} must have the properties defined in Equations \ref{eqn:rtprop_1},
\ref{eqn:rtprop_2} and \ref{eqn:rtprop_3}.

\begin{eqnarray}
\label{eqn:rtprop_1}
\forall i, C_{i} \le D_{i}\\
\label{eqn:rtprop_2}
\forall i, R_{i} \le D_{i}\\
\label{eqn:rtprop_3}
\forall i, D_{i} \le T_{i}
%U_{i}, \displaystyle{\sum_{i \in [1, n]}} U_{i} \le 1
%\label{eqn:rtprop_3}
\end{eqnarray}

\subsection{Definition of a task set}

\paragraph{}
A task set is defined like:
\begin{itemize}
\item a set of tasks $\tau_i$. Each task having its own Real-Time properties as defined in Section
\ref{sec:primarydef}.
\item Each task is executed through multiple instantiations, denoted jobs, corresponding to an
execution thread.
\item An arrival profile, defining when each job is reloaded (periodically, sporadically or
aperiodically).
\end{itemize}

\paragraph{}
For a given task $\tau_{i}$ of a given task set, we then define the associated schedulability,
through the system capacity to schedule each instantiated job.\\
A task set is necessarily finished, and have fixed characteristics.

\subsubsection{Periodic task sets}

\paragraph{}
Periodic task sets respect the following property:\\
\begin{property}
Each task $\tau_{i}$ is instantiated every period $P_{i}$. Knowning the first instantiation the
task is enough to know the arrival time of all its jobs.
\end{property}

\paragraph{}
Moreover, it is possible to measure the maximum load induce by this task, using the associated WCET
and Period. The load variation induce by this task depends on the variation of the execution time
$R_{i}$ of each job.

\subsubsection{Sporadic task sets}

\paragraph{}
Sporadic task sets respect the following property:\\
\begin{property}
Each task $\tau_{i}$ is instantiated with a known minimum Period $P_{i}$.
\end{property}

\paragraph{}
Depending on each job arrival time, the task set schedulability may be harder to meet than a
periodic task set containing the same Real-Time tasks.

\paragraph{}
Arrival times is then not predictable and the current execution time $R_{i}$ of a job also depends
on the arrival time of the others concurrently executed jobs.

\subsubsection{aperiodic task sets}

\paragraph{}
Aperiodic task sets respect the following property:\\
\begin{property}
For each task $\tau_i$ of the task set, no minimum Period $P_{i}$ is defined.
\end{property}

\paragraph{}
The worst load $U_i$ associated to a given task $\tau_i$ is unknown, and the associated Period
$P_i$ is defined as a variable value in $[0, +\infty[$

\subsubsection{Windowed task sets}

\paragraph{}
Considering a sliding time window ${\Delta}t$, a maximum number of interruptions is defined. This
value is used in order to define the worst case number of external events impacting the execution
of currently schedulable jobs, impacting their WCET.

\subsection{About the task sets dynamic}

\subsubsection{Concrete sets}

\subsubsection{Dis-concrete sets}

\section{Introducing the WCET estimation}

\paragraph{}
Measuring the \gls{wcet} is difficult for various reasons. Indeed, in order to define the necessary
system capacities in order to execute a given task, all input variables impacting the system
behaviour must be known or upper-bounded.

\paragraph{}
Because the impact of the software behaviour on the hardware latency is huge, some of the hardware
elements are usually deactivated in order to reduce the uncontrolled impact on the task set
execution. It is the case, for example, of the DMA controllers, generating slow downs in jobs
execution.

\paragraph{}
A first approach is to reduce the slow down due to concurrent unschedulable events to an
upper-bounded load percentage per sliding time window through macroscopic measurement of such events
(interrupts, cache-based preemption delays, bubbles and other imacts on the processor's pipeline, etc).
Such measurement is hard to adjust, and is usually pessimistic.\\
To this percentage should be added the impact of the base software execution (e.g. the scheduler
own execution cost). When the base software is designed for Real-Time systems, its execution cost
is more easily defined, and then added to the other unscheduled events.\\
Unschedulable events can be measured more accurately, but at the loss of portability. Modifying
just a small part of the underlying hardware implies a new measurement of its impact.

\paragraph{}
Measuring the worst case execution time of a given task is then measured through multiple
techniques, depending on the level of Real-Time to achieve:
\begin{itemize}
\item WCET measurement through static estimation of Real-Time tasks
\item WCET measurement through empiric scenarios.
\end{itemize}

\section{Static WCET estimation methods}

\subsection{Analysing the execution flow}

\paragraph{}
Considering a given task, an execution tree can be defined in order to represent all the possible
execution path. Such measurement is done using the generated assembler execution in order to be
representative of the resulting binary execution. Using high level languages to define worst case
execution flow is too much impacted by the compiler execution to be representative of the generated
executable.

\paragraph{}
Using this tree, it is possible to define the worst case execution path (\gls{wcep}) of the task.
Though it is difficult to determine if the selected branch is possible, because such measurement
can't take into account external variables impacting the execution flow, like reading a given
content in a shared memory.\\
Using code coverage on the assembler code guarantee that the given branch is effectively executed,
and then may be the worst case execution path of the task.\\
Using pipelined processors, branch prediction and hyper-threading may accelerate the execution flow.
As a consequence, the measured WCEP may be relatively pessimistic.

\subsection{Using abstract interpretation}

\subsection{Measurement with hardware architecture simulation using symbolic variables}

\paragraph{}
Some work has been done \FIXME{get back articles} in order to consider more precisely the impacts
of the internal processor archiecture like pipelines and cache controllers behaviours.\\
Such considerations greatly increase the precision of the WCET measurement.

\section{Dynamic WCET estimation method}

\subsection{Empiric measurements}

\paragraph{}
When static WCET measurement is not feasible or not necessary, it is possible to define a
representative execution scenario. Such empirical measurement defines an estimated WCET for each
task. Such WCET precision depend on the representativity and the coverage of the scenario for all
tasks. The more the tasks use synchronisation mechanisms, the more complex the scenario is.

\paragraph{}
The difficulty of such measurement is due to the representativity of the task set behaviour in term
of execution dynamism (cost of asm branching, memory access latency, buffers and caches behaviours, etc).

\subsection{Defining a representative test suite}

\section{Conclusion}

\paragraph{}
Through this chapter, basic notions of Real-Time systems has been defined and current problematics
explained. The following chapter describes the existing scheduling policies and the consequence of
the modern hardware architecture on the current researches on the scheduling schemes.

